---
layout: layouts/base.liquid
title: Find Assistance Programs For You
permalink: 
  build: "/public-assistance/eligibility/index.html"
pageClass: "page-public-assistance"
---

<h1>{{title}}</h1>

<p>
  Use this tool to find assistance programs for which you qualify.  Fill in each field to the best of your knowledge.  <span class="bold">The information you enter here is completely private and will not be transmitted or stored in any way.</span>
</p>
<p>
  After entering your information, you will be provided with a list of assistance programs you can apply for.
</p>

<div id="form-top" class="section_map">
  <ul>
  </ul>
</div>

<form id="eligibility">
  <div id="section-intro" class="elig_section" >
    <div id="page-intro" class="elig_page">
      <p>
        Introductory text.
      </p>
      <p>
        This form will ask you about a variety of things.
      </p>
    </div>
  </div>

  <div id="section-things-you-like" class="elig_section hidden">
    <h2>Yourself</h2>
    <p>
      This section-level text will be shown for every page in this section.
    </p>
    <div id="page-select-likes" class="elig_page hidden">
      <div id="likes-wrapper">
        If "I like days of the week" is selected, a secondary follow-up page will be shown.  Otherwise, the form will move on to the next section.  Select all that apply:
        <ul class="multiselect">
          <li>
            <input id="likes-animals" type="checkbox" name="option">
            <label for="likes-animals">I like animals.</label>
          </li>
          <li>
            <input id="likes-vehicles" type="checkbox" name="option">
            <label for="likes-vehicles">I like vehicles.</label>
          </li>
          <li>
            <input id="likes-days" type="checkbox" name="option">
            <label for="likes-days">I like days of the week.</label>
          </li>
        </ul>
      </div>
    </div>
    <div id="page-today" class="elig_page hidden">
      <p>
        This page is only shown if the user selected "I like days of the week" on the previous page.
      </p>
      <div id="weekday-wrapper">
        <label for="weekday">What day of the week is it?</label>
        <input id="weekday" type="text">
      </div>

      <div id="date-wrapper">
        <label for="date">What is the date?</label>
        <input id="date" type="number">
      </div>
    </div>
  </div>
  
  <div id="section-color" class="elig_section hidden">
    <h2>Your Household</h2>
    <div id="page-color" class="elig_page hidden">
      <p>
        Here we are in a new section.
      </p>
      <div id="favorite-color-wrapper">
        <label for="favorite-color">What is your favorite color?</label>
        <input id="favorite-color" type="text">
      </div>
    </div>
  </div>

  <div id="section-income" class="elig_section hidden">
    <h2>Income</h2>
    <div id="page-income" class="elig_page hidden">
      Example text
    </div>
  </div>

  <div id="section-existing-assistance" class="elig_section hidden">
    <h2>Existing Assistance</h2>
    <div id="page-assistance" class="elig_page hidden">
      More form fields to do.
    </div>
  </div>

  <div id="section-results" class="elig_section hidden">
    <h2>Results</h2>
    <div id="page-results" class="elig_page hidden">
      <p>
        This is an example results page that would show content based on form input values.
        <ul>
          <li>Result 1</li>
          <li>Result 2</li>
          <li>Result 3</li>
          <li>Result 4</li>
        </ul>
      </p>
    </div>
  </div>

  <div id="controls">
    <button type="button" class="btn btn_secondary hidden" id="back-button">Back</button>
    <button type="button" class="btn btn_primary" id="next-button">Next</button>
    <button type="button" class="btn btn_primary hidden" id="submit-button">Finish</button>
  </div>
</form>

<script>
  let currentPage;

  function setElementVisibility(elem, makeVisible) {
    if (elem) {
      if (makeVisible) {
        elem.classList.remove("hidden");
      } else {
        elem.classList.add("hidden");
      }
    }
  }

  function setSubmitVisibility(makeVisible) {
    const submitButton = document.getElementById("submit-button");
    setElementVisibility(submitButton, makeVisible);
  }

  function setNextVisibility(makeVisible) {
    const nextButton = document.getElementById("next-button");
    setElementVisibility(nextButton, makeVisible);
  }

  function setBackVisibility(makeVisible) {
    const backButton = document.getElementById("back-button");
    setElementVisibility(backButton, makeVisible);
  }

  function resetScroll() {
    document.getElementById("form-top").scrollIntoView();
  }

  function markSectionDone(section) {
    if (section.stepButton) {
      section.stepButton.classList.remove("todo");
      section.stepButton.disabled = false;
      section.stepButton.classList.add("done");
    }
  }

  function configureButtons(page) {
    let resultsPage = !page.next();
    // TODO: is there a better way than 'results'?
    let finalInputPage = page.next()?.id == 'page-results'
    let firstPage = !page.previous;
    if (finalInputPage) {
      setBackVisibility(true);
      setNextVisibility(false);
      setSubmitVisibility(true);
    } else if (firstPage) {
      setBackVisibility(false);
      setNextVisibility(true);
      setSubmitVisibility(false);
    } else if (resultsPage) {
      setBackVisibility(true);
      setNextVisibility(false);
      setSubmitVisibility(false);
    } else {
      setBackVisibility(true);
      setNextVisibility(true);
      setSubmitVisibility(false);
    }
  }

  function buildStepIndicator() {
    const allSections = document.querySelectorAll("div.elig_section");
    const stepIndicatorList = document.querySelector("div.section_map ul");
    for (const section of allSections) {
      const heading = section.querySelector("h2");
      if (!heading) {
        continue;
      }
      const button = document.createElement("button");
      button.id = "nav-" + section.id;
      button.dataset.sectionId = section.id;
      button.className = "todo";
      button.textContent = heading.textContent;
      button.disabled = true;
      button.addEventListener("click", toSection);
      section.stepButton = button;
      const listItem = document.createElement("li");
      listItem.appendChild(button);
      stepIndicatorList.appendChild(listItem);
    }
  }

  function setUpUi() {
    buildStepIndicator();
  }

  function makePages() {
    pages = document.querySelectorAll("div.elig_page");
    pageById = {};
    for (let j = 0; j < pages.length; j++) {
      pages[j].section = pages[j].parentElement;
      pages[j].next = function() {
        return pages[j + 1];
      };
      pageById[pages[j].id] = pages[j];
    }
    currentPage = pages[0];
    connectPages(pageById);
  }

  function connectPages(pageById) {
    pageById["page-select-likes"].next = function() {
      const likesDays = document.getElementById("likes-days").checked;
      if (likesDays) {
        return pageById["page-today"];
      } else {
        return pageById["page-color"];
      }
    };
  }

  function switchToPage(toPage) {
    setElementVisibility(currentPage, false);
    setElementVisibility(toPage, true);
    if (toPage.section.id != currentPage.section.id) {
      setElementVisibility(currentPage.section, false);
      setElementVisibility(toPage.section, true);
      if (currentPage.section.stepButton) {
        currentPage.section.stepButton.classList.remove("in_progress");
      }
      if (toPage.section.stepButton) {
        toPage.section.stepButton.classList.add("in_progress");
      }
    }
    configureButtons(toPage);
    resetScroll();
    currentPage = toPage;
  }

  // TODO: Navigating to results this way should recompute the results.
  function toSection() {
    const section = document.getElementById(this.dataset.sectionId);
    const toPage = section.querySelector("div.elig_page");
    if (toPage) {
      switchToPage(toPage);
    }
  }

  function toNextPage() {
    const nextPage = currentPage.next();
    if (nextPage) {
      if (nextPage.section.id != currentPage.section.id) {
        markSectionDone(currentPage.section);
      }
      nextPage.previous = currentPage;
      switchToPage(nextPage);
    }
  }

  function toPrevPage() {
    const previousPage = currentPage.previous;
    if (previousPage) {
      switchToPage(previousPage);      
    }
  }

  function computeEligibility() {
    console.log("TODO: Determine program eligibility");
  }

  function submitForm() {
    computeEligibility();
    toNextPage();
    markSectionDone(currentPage.section);
  }

  function addListeners() {
    document.getElementById("next-button").addEventListener("click", toNextPage);
    document.getElementById("back-button").addEventListener("click", toPrevPage);
    document.getElementById("submit-button").addEventListener("click", submitForm);
  }

  // Script entry point.
  function run() {
    makePages();
    setUpUi();
    addListeners();
  }

  run();
</script>