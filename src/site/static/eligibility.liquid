---
layout: layouts/base.liquid
title: Find Assistance Programs For You
permalink: 
  build: "/public-assistance/eligibility/index.html"
pageClass: "page-public-assistance"
---

<h1>{{title}}</h1>
<div>
  <div class="progress_bar flex"><div id="done-bar" class="progress_bar done"></div><div id="to-do-bar" class="progress_bar remaining"></div></div>
  <div class="flex">
    <span class="badge badge__done"><span id="done-val" class="bold">0</span><span class="bold">%</span> done</span>
    <span class="badge badge__remaining"><span id="to-do-val" class="bold">100</span><span class="bold">%</span> remaining</span>
  </div>
</div>

<div class="section_map flex">
  <div class="section_marker badge">Section Name</div>
  <div class="section_marker badge">Next Section</div>
  <div class="section_marker badge">Another Section</div>
</div>

<form id="eligibility">
  <div class="elig_section" id="section-intro">
    <div class="elig_page" id="page-intro">
      <p>
        Use this tool to find assistance programs for which you qualify.  Fill in each field to the best of your knowledge.  <span class="bold">The information you enter here is completely private and will not be transmitted or stored in any way.</span>
      </p>
      <p>
        After entering your information, you will be provided with a list of assistance programs you can apply for.
      </p>
    </div>
  </div>

  <div class="elig_section hidden" id="section-things-you-like">
    <h2>Things You Like</h2>
    <p>
      This section-level text will be shown for every page in this section.
    </p>
    <div class="elig_page hidden" id="page-select-likes">
      <div id="likes-wrapper">
        If "I like days of the week" is selected, a secondary follow-up page will be shown.  Otherwise, the form will move on to the next section.  Select all that apply:
        <ul>
          <li>
            <input id="likes-animals" type="checkbox" name="option">
            <label for="likes-animals">I like animals.</label>
          </li>
          <li>
            <input id="likes-vehicles" type="checkbox" name="option">
            <label for="likes-vehicles">I like vehicles.</label>
          </li>
          <li>
            <input id="likes-days" type="checkbox" name="option">
            <label for="likes-days">I like days of the week.</label>
          </li>
        </ul>
      </div>
    </div>
    <div class="elig_page hidden" id="page-today">
      <p>
        This page is only shown if the user selected "I like days of the week" on the previous page.
      </p>
      <div id="weekday-wrapper">
        <label for="weekday">What day of the week is it?</label>
        <input id="weekday" type="text">
      </div>

      <div id="date-wrapper">
        <label for="date">What is the date?</label>
        <input id="date" type="number">
      </div>
    </div>
  </div>
  
  <div class="elig_section hidden" id="section-color">
    <h2>All About Colors</h2>
    <div class="elig_page hidden" id="page-color">
      <p>
        Here we are in a new section.
      </p>
      <div id="favorite-color-wrapper">
        <label for="favorite-color">What is your favorite color?</label>
        <input id="favorite-color" type="text">
      </div>
    </div>
  </div>

  <div>
    <button type="button" class="btn btn_secondary hidden" id="back-button">Back</button>
    <button type="button" class="btn btn_primary" id="next-button">Next</button>
    <button type="button" class="btn btn_primary hidden" id="submit-button">Finish</button>
  </div>
</form>

<script>
  let currentPageNumber = 0;
  let finalPageNumber = 0;
  // TODO: is it necessary to group pages by section in the array?
  let pageArray = [];
  let sectionMap = {};
  let pageMap = {};
  
  let currentPage;
  let currentSection;

  function setElementVisibility(elem, makeVisible) {
    if (elem) {
      if (makeVisible) {
        elem.classList.remove("hidden");
      } else {
        elem.classList.add("hidden");
      }
    }
  }

  function setPageVisibility(pageNumber, makeVisible) {
    const page = document.getElementById("page-" + pageNumber);
    setElementVisibility(page, makeVisible);
  }

  function setSubmitVisibility(makeVisible) {
    const submitButton = document.getElementById("submit-button");
    setElementVisibility(submitButton, makeVisible);
  }

  function setNextVisibility(makeVisible) {
    const nextButton = document.getElementById("next-button");
    setElementVisibility(nextButton, makeVisible);
  }

  function setBackVisibility(makeVisible) {
    const backButton = document.getElementById("back-button");
    setElementVisibility(backButton, makeVisible);
  }

  function updateProgress(page) {
    const doneVal = document.getElementById("done-val");
    const todoVal = document.getElementById("to-do-val");
    const doneBar = document.getElementById("done-bar");
    const todoBar = document.getElementById("to-do-bar");
    const numPages = pageArray.length;
    if (numPages > 0) {
      const donePercent = 100 * Math.max(0, page.idx) / numPages;
      const todoPercent = 100 - donePercent;
      doneBar.style.width = donePercent + "%";
      todoBar.style.width = todoPercent + "%";
      doneVal.textContent = donePercent;
      todoVal.textContent = todoPercent;
    }
  }

  function configureButtons(page) {
    let finalPage = !page.next()
    let firstPage = !page.previous
    if (finalPage) {
      setBackVisibility(true);
      setNextVisibility(false);
      setSubmitVisibility(true);
    } else if (firstPage) {
      setBackVisibility(false);
      setNextVisibility(true);
      setSubmitVisibility(false);
    } else {
      setBackVisibility(true);
      setNextVisibility(true);
      setSubmitVisibility(false);
    }
  }

  function gatherPages() {
    pageArray = document.querySelectorAll("div.elig_page");
    for (let j = 0; j < pageArray.length; j++) {
      pageArray[j].idx = j;
      pageArray[j].section = pageArray[j].parentElement;
      pageArray[j].next = function() {
        return pageArray[j + 1];
      };
      pageMap[pageArray[j].id] = pageArray[j];
    }
    console.log(pageArray);
    console.log(pageMap);
    currentPage = pageArray[0];
  }

  function connectPages() {
    pageMap["page-select-likes"].next = function() {
      const likesDays = document.getElementById("likes-days").checked;
      if (likesDays) {
        return pageMap["page-today"];
      } else {
        return pageMap["page-color"];
      }
    };
  }

  function nextPage() {
    console.dir(currentPage);
    console.log(currentPage.idx);
    nextPage = currentPage.next();
    console.dir(nextPage);
    if (nextPage) {
      setElementVisibility(currentPage, false);
      setElementVisibility(nextPage, true);
      if (nextPage.section.id != currentPage.section.id) {
        setElementVisibility(currentPage.section, false);
        setElementVisibility(nextPage.section, true);
      }
      nextPage.previous = currentPage;
      currentPage = nextPage;
    }
    configureButtons(currentPage);
    updateProgress(currentPage);
    
  }

  function prevPage() {
    let previousPage = currentPage.previous;
    if (previousPage) {
      setElementVisibility(currentPage, false);
      setElementVisibility(previousPage, true);
      if (previousPage.section.id != currentPage.section.id) {
        setElementVisibility(currentPage.section, false);
        setElementVisibility(previousPage.section, true);
      }
      currentPage = previousPage;
    }
    configureButtons(currentPage);
    updateProgress(currentPage);
  }

  function submitForm() {
    console.log("Determining program eligibility");
    // TODO
  }

  function addListeners() {
    document.getElementById("next-button").addEventListener("click", nextPage);
    document.getElementById("back-button").addEventListener("click", prevPage);
    document.getElementById("submit-button").addEventListener("click", submitForm);
  }

  // Script entry point.
  function run() {
    // countPages();
    gatherPages();
    connectPages();
    addListeners();
  }

  run();
</script>